<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Accordion Timeline</title>
    <link type="text/css" rel="stylesheet" href="/css/ja_level.css">
</head>

<body>
    <div class="accordion-container">
        <!-- 弹窗容器 -->
        <div id="modal-overlay" style="display: none;">
            <div id="modal-content">
                <span id="modal-close">&times;</span>
                <div id="modal-body"></div>
            </div>
        </div>

        <!-- Level 1 Timeline -->
        <div class="accordion-item" data-level="1">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                1 完全初学者<span>用日语“做”任务</span>
                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 96 960 960" width="24">
                    <path d="M480 696 240 456h480L480 696Z" />
                </svg>
            </div>
            <div class="accordion-content">
                <div class="timeline-item">
                    <div class="circle">1</div>
                    <a href="/components/ja_level/j1_1.html" class="modal-link">能力陈述</a>
                </div>
                <div class="timeline-item">
                    <div class="circle">2</div>
                    <a href="/components/ja_level/j1_2.html" class="modal-link">平假名表</a>
                </div>
                <div class="timeline-item">
                    <div class="circle">3</div>
                    <a href="/components/ja_level/j1_3.html" class="modal-link">基础词汇</a>
                </div>
                <div class="timeline-item">
                    <div class="circle">4</div>
                    <a href="/components/ja_level/j1_4.html" class="modal-link">语法要点</a>
                </div>
            </div>
        </div>

        <!-- Level 2 Timeline -->
        <div class="accordion-item" data-level="2">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                2 初学者
                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 96 960 960" width="24">
                    <path d="M480 696 240 456h480L480 696Z" />
                </svg>
            </div>
            <div class="accordion-content">
                <div class="timeline-item">
                    <div class="circle">1</div>
                    <a href="/components/ja_level/j2_1.html" class="modal-link">Level</a>
                </div>
                <div class="timeline-item">
                    <div class="circle">2</div>
                    <a href="/components/ja_level/j2_2.html" class="modal-link">Level</a>
                </div>
            </div>
        </div>

        <!-- Level 3 Timeline -->
        <div class="accordion-item" data-level="3">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                3 中级
                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 96 960 960" width="24">
                    <path d="M480 696 240 456h480L480 696Z" />
                </svg>
            </div>
            <div class="accordion-content">
                <div class="timeline-item">
                    <div class="circle">1</div>
                    <a href="/components/ja_level/j3_1.html" class="modal-link">Level</a>
                </div>
                <div class="timeline-item">
                    <div class="circle">2</div>
                    <a href="/components/ja_level/j3_2.html" class="modal-link">Level</a>
                </div>
            </div>
        </div>

        <!-- Level 4 Timeline -->
        <div class="accordion-item" data-level="4">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                4 中高级
                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 96 960 960" width="24">
                    <path d="M480 696 240 456h480L480 696Z" />
                </svg>
            </div>
            <div class="accordion-content">
                <div class="timeline-item">
                    <div class="circle">1</div>
                    <a href="/components/ja_level/j4_1.html" class="modal-link">Level</a>
                </div>
                <div class="timeline-item">
                    <div class="circle">2</div>
                    <a href="/components/ja_level/j4_2.html" class="modal-link">Level</a>
                </div>
            </div>
        </div>

        <!-- Level 5 Timeline -->
        <div class="accordion-item" data-level="5">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                5 高级
                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 96 960 960" width="24">
                    <path d="M480 696 240 456h480L480 696Z" />
                </svg>
            </div>
            <div class="accordion-content">
                <div class="timeline-item">
                    <div class="circle">1</div>
                    <a href="/components/ja_level/j5_1.html" class="modal-link">Level</a>
                </div>
                <div class="timeline-item">
                    <div class="circle">2</div>
                    <a href="/components/ja_level/j5_2.html" class="modal-link">Level</a>
                </div>
            </div>
        </div>

        <!-- Level 6 Timeline -->
        <div class="accordion-item" data-level="6">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                ★ 额外内容
                <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 96 960 960" width="24">
                    <path d="M480 696 240 456h480L480 696Z" />
                </svg>
            </div>
            <div class="accordion-content">
                <div class="timeline-item">
                    <div class="circle">1</div>
                    <a href="/components/ja_level/j6_1.html" class="modal-link">Level</a>
                </div>
                <div class="timeline-item">
                    <div class="circle">2</div>
                    <a href="/components/ja_level/j6_2.html" class="modal-link">Level</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // JS 优化后的逻辑
        function initAccordion() {
            const allHeaders = document.querySelectorAll(".accordion-header");
            const allContents = document.querySelectorAll(".accordion-content");

            // 默认展开所有手风琴项
            allHeaders.forEach((header) => {
                header.classList.add("open");
            });
            allContents.forEach((content) => {
                content.style.display = "block";
            });

            // 添加点击事件监听
            allHeaders.forEach((header) => {
                header.addEventListener("click", () => toggleAccordion(header, allHeaders, allContents));
            });
        }

        function toggleAccordion(header, allHeaders, allContents) {
            const isOpen = header.classList.contains("open");

            // 关闭所有手风琴
            allHeaders.forEach((h) => h.classList.remove("open"));
            allContents.forEach((c) => (c.style.display = "none"));

            // 如果当前手风琴项是关闭状态，则打开
            if (!isOpen) {
                header.classList.add("open");
                header.nextElementSibling.style.display = "block";
            }
        }

        function initModal() {
            const links = document.querySelectorAll(".timeline-item a");
            const modalOverlay = document.getElementById("modal-overlay");
            const modalBody = document.getElementById("modal-body");
            const modalClose = document.getElementById("modal-close");

            // 显示弹窗
            links.forEach((link) => {
                link.addEventListener("click", (event) => {
                    event.preventDefault();
                    const url = link.getAttribute("href");

                    showModal(modalOverlay, modalBody, url);
                });
            });

            // 关闭弹窗
            modalClose.addEventListener("click", () => {
                closeModal(modalOverlay);
            });

            modalOverlay.addEventListener("click", (event) => {
                if (event.target === modalOverlay) {
                    closeModal(modalOverlay);
                }
            });
        }

        function showModal(modalOverlay, modalBody, url) {
            modalOverlay.style.display = "flex";
            modalBody.innerHTML = "<p>加载中...</p>";

            fetch(url)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("网络错误：" + response.status);
                    }
                    return response.text();
                })
                .then((html) => {
                    modalBody.innerHTML = html;
                })
                .catch((error) => {
                    modalBody.innerHTML = `<p style='color: red;'>加载失败：${error.message}</p>`;
                });
        }

        function closeModal(modalOverlay) {
            modalOverlay.style.display = "none";
        }

        function init() {
            initAccordion();
            initModal();
        }

        document.addEventListener("DOMContentLoaded", init);
    </script>
</body>

</html>